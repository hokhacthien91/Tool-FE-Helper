<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    button {
      margin-top: 10px;
      padding: 8px 16px;
      background: #18A0FB;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:disabled {
      background: #ccc;
    }
    .error {
      color: red;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>Generate Global Style</h2>
  <p>Select the global.json file to generate the style guide.</p>
  <input type="file" id="fileInput" accept=".json">
  <button id="generateBtn" disabled>Generate</button>
  <div id="message" class="error"></div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const generateBtn = document.getElementById('generateBtn');
    const message = document.getElementById('message');

    fileInput.addEventListener('change', () => {
      generateBtn.disabled = !fileInput.files.length;
      message.textContent = '';
    });

    generateBtn.addEventListener('click', () => {
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const json = JSON.parse(e.target.result);
          parent.postMessage({ pluginMessage: { type: 'generate', data: json } }, '*');
        } catch (err) {
          message.textContent = 'Invalid JSON file.';
        }
      };
      reader.readAsText(file);
    });

    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (msg && msg.type === 'status') {
        message.style.color = msg.error ? 'red' : 'green';
        message.textContent = msg.message;
      }
    };
  </script>
</body>
</html>

